{% extends 'base.html' %}

{% block content %}
<div class="container my-4">
  <h3 class="mb-3">All Orders</h3>
  <div class="table-responsive">
    <table class="table table-striped table-bordered align-middle">
      <thead class="table-dark">
        <tr>
          <th>#</th>
          <th>Order ID</th>
          <th>Name</th>
          <th>Address</th>
          <th>Items</th>
          <th>Total</th>
          <th>Payment Type</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for o in orders %}
        <tr>
          <td>{{ o.id }}</td>
          <td>{{ o.order_id }}</td>
          <td>
            {{ o.name }}<br>
            <small>{{ o.phone }}<br>{{ o.email }}</small>
          </td>
          <td style="max-width:250px;">
            <small>{{ o.address }}</small>
          </td>
          <td style="max-width:300px;">
            <small>
              {% for it in o.order_items %}
                • {{ it.name }} ({{ it.size or '-' }}) x {{ it.qty }} = ₹{{ it.subtotal }}<br>
              {% endfor %}
            </small>
          </td>
          <td>₹{{ '%.2f'|format(o.total_price or 0) }}</td>
          <td>{{ o.utr or '-' }}</td>
          <td>
            <form method="POST" action="{{ url_for('admin_update', order_id=o.order_id) }}" class="d-flex gap-2">
              <select name="status" class="form-select form-select-sm">
                {% for s in ['Pending','Confirm','Delivery'] %}
                  <option value="{{ s }}" {% if o.status==s %}selected{% endif %}>{{ s }}</option>
                {% endfor %}
              </select>
              <button class="btn btn-sm btn-primary">Save</button>
            </form>
          </td>
          <td>
            <form method="POST" action="{{ url_for('admin_delete', order_id=o.order_id) }}" onsubmit="return confirm('Are you sure you want to delete this order?')">
              <button class="btn btn-sm btn-outline-danger">Delete</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
